# Type of Authorization Requests

The proof generation by the wallet sdk is based on two types of authorization requests that it sends to the Verifier:

- Based on `Basic Auth` Requests
- Based on `Query` Requests 

## Basic Auth Request

THe wallet sdk sends the `Basic Auth` request when it needs to prove its identity (based on the Identifier generated earlier) to the Verifier. This request is sent when an Identity needs to prove that it is, indeed, the Identity that it says about itself. 

### Structure of Basic Auth Request

The struture of a `Basic Auth` request can be seen below:

```json

{
  "id": "6c004daa-b664-4c1a-8393-66ef6755a07b",
  "thid": "6c004daa-b664-4c1a-8393-66ef6755a07b",
  "from": "1125GJqgw6YEsKFwj63GY87MMxPL9kwDKxPUiwMLNZ",
  "typ": "application/iden3comm-plain-json",
  "type": "https://iden3-communication.io/authorization/1.0/request",
  "body": {
    "reason": "test flow",
    "message": "",
    "callbackUrl": "https://verifier.polygonid.me/api/callback?sessionId=95209",
    "scope": 
  }
}

```
**Note**: The details of each of the fields of the request can be seen in the section below on Query Request.

## Query-based Request

A Query-Based Request is used for generating two types of proofs: Signature based Proof and Merkle Tree Proof (MTP). For such proofs, we have claim(s) that satifies a pre-determined crietria (as can be seen from the structure of the Query-based Request below) and these claims are used for generating the proofs and shared with the Verifier using `callbackUrl`. 


### Structure of Query-based Request 


```json

{
  "id": "b5d9edf2-adcf-4600-b273-1f6f32da87ee",
  "thid": "b5d9edf2-adcf-4600-b273-1f6f32da87ee",
  "from": "1125GJqgw6YEsKFwj63GY87MMxPL9kwDKxPUiwMLNZ",
  "typ": "application/iden3comm-plain-json",
  "type": "https://iden3-communication.io/authorization/1.0/request",
  "body": {
    "reason": "test flow",
    "message": "",
    "callbackUrl": "https://verifier.polygonid.me/api/callback?sessionId=932469",
    "scope": {
      "0": {
        "id": "1",
        "circuit_id": "credentialAtomicQuerySig",
        "rules": {
          "query": {
            "allowedIssuers": 
                "0": "*",
            "schema": {
                "type": "KYCAgeCredential",
                "url": "https://raw.githubusercontent.com/iden3/claim-schema-vocab/main/schemas/json-ld/kyc-v2.json-ld"
            },
            "req": {
                "birthday": {
                    "$lt": "20000101"
              }
            }
          }
        }
      }
    }
  }
}

```

where:

 - **id**: Identifier stored on the wallet sdk

 - **thid**: Thread ID
 - **from**: from where the authentication request comes, i.e. the identifier of the identity from which a Verifier requests proof
 - **typ**: iden3comm Media Type, i.e. File format for the type field. (For example, JSON)
 - **type**: Type of iden3comm Protocol Message; type of request; it could be an auth request, proof request,or a claim offer
 - **reason**: reason of authentication (it could be age verification or simply a test flow)
 - **message**: Message to sign; can be left blank
 - **callbackUrl**: URL to which requested information is sent and response is received
 - **scope**: information realeted to the prrof request and the requiremenst to be fulfilled by the proof generated and shared from mobile. It is in the form of an array of proofs that the sdk generates. 
 - **0**: 
 - **id**: Scope id
 - **circuit_id**: Type of proof; in the above example, it is credentialAtomicQuerySig.
 - **rules**:
 - **query**:
 - **allowedissuers**: types of Issuers allowed
 - **0: "*"** : All types of Issuers are allowed
 - **schema**: A structure that is used for proof generation
 - **type**: Type of credentails allowed
 - **url**: url for getting the vocabulary  for the credential
 - **req**: A query request to a query circuit; for example, the user's birthday should fall before January 1, 2000


## Difference Between `Basic Auth` and `Query-based` Proofs

The difference between the proofs based on `Basic Auth` and `Query-based` requests is that the `Basic Auth` is used by an identity for authenticating itself (as was mentioned above) and the `Query-based`is used for authenticating the claims that the Identity receives from an Issuer. The fundamental structure of teh request types is the same except that the `Query-based` request carries more parameters: in the form of more information linked to the proof generated by the wallet sdk; it includes information such as type of credentails allowed, url for getting vocabulary for those cfedentail and requirements that a claim must satisfy (ex, birth date should be more than 18) 

## Difference between Signature-based and Merkle Tree Proofs

The basic difference between a Signature-based and MTP proof is based on time: A Signature Proof requires that a particular cliam fulfills certain requirements. On the other hand, a Merkle Tree Proof requires status of a claim at a particular moment of time; sich a claim is generated and published on-chain and the proof requires that the claim is not revoked or expired at a particular point in time. 

## How is Proof sent to the Verifier?

The wallet sdk sends the proof generated to a Verifier using a `callbackUrl`; this url is included in the auth request and includes the infirmation that the Verifier requests from the wallet sdk. So, the sdk sends the proof request  along with claim via this `callbackUrl` and receives the proof response from the Verifier on the same Url. 



