# Smart Contracts

### State Contract

[**State.sol - Github**](https://github.com/iden3/contracts/blob/master/contracts/State.sol)

The state contract stores the state of each identity operating within Polygon ID. Each identity has an [identifier](../getting-started/identity/identifier.md) and an [identity state](../getting-started/identity/identity-state.md) associated to it. Each identifier and the corresponding identity state are stored inside the [`identities`](https://github.com/iden3/contracts/blob/master/contracts/State.sol#L54) mapping. 

An identity gets updated by executing the [state transition function](../getting-started/state-transition/on-chain-state-transition.md). The State contract verifier the proof on-chain via its [`transitState`](https://github.com/iden3/contracts/blob/master/contracts/State.sol#L87) function.

The State contract provides a timestamp of the changes that occur inside an identity state. No personal information (such as claims) is stored on-chain nor it is inferrable from the information stored on-chain.

Note that the actual proof verification is executed by calling the `verifyProof` function inside the [verifier.sol](https://github.com/iden3/contracts/blob/master/contracts/lib/verifier.sol). 

The `verifier.sol` contract is automatically generated using circom and can be used as a standalone contract to verify the proof. `State.sol` implements further logic once the proof is verified (such as updating the identity state).

State contract addresses:

- [Mumbai: 0x46Fd04eEa588a3EA7e9F055dd691C688c4148ab3](https://mumbai.polygonscan.com/address/0x46Fd04eEa588a3EA7e9F055dd691C688c4148ab3)
- [Polygon Mainnet: 0xb8a86e138C3fe64CbCba9731216B1a638EEc55c8](https://polygonscan.com/address/0xb8a86e138C3fe64CbCba9731216B1a638EEc55c8)

### CredentialAtomicQuerySigValidator

[**CredentialAtomicQuerySigValidator.sol - Github**](https://github.com/0xPolygonID/contracts/blob/main/contracts/validators/CredentialAtomicQuerySigValidator.sol)

The CredentialAtomicQuerySigValidator contract is used verify any claim-related zk proof generated by user using the [`credentialAtomicQuerySig`](../circuits/main-circuits.md#credentialatomicquerysig) circuit. The core of the contract is its [`verify`](https://github.com/0xPolygonID/contracts/blob/main/contracts/validators/CredentialAtomicQuerySigValidator.sol#L52) function that takes the proof generated by a user and executes a set of verification:

- Verifies that the actually proof if valid. This verification is actually performed inside the [`verifierSig`](https://github.com/0xPolygonID/contracts/blob/main/contracts/verifiers/circuits/verifierSig.sol) contract which is automatically generated using circom
- Verifies that the input used to generate the proof matches the query associated to that specific Request
- Verifies that user's and issuer's identity states are valid based on the State Contract

> The CredentialAtomicQuerySigValidator executes the same set of verifications of the [Verification Library](../verifier/verification-library/verification-api-guide.md#verification---under-the-hood). The former is required when performing on-chain verification while the latter is required for off-chain verification.

CredentialAtomicQuerySigValidator addresses:

- [Mumbai: 0xb1e86C4c687B85520eF4fd2a0d14e81970a15aFB](https://mumbai.polygonscan.com/address/0xb1e86C4c687B85520eF4fd2a0d14e81970a15aFB)
